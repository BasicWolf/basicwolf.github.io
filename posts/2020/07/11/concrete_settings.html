
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Lexend+Deca:wght@100..900&display=swap&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://zaurnasibov.com/theme/stylesheet/style.min.css">


    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="https://zaurnasibov.com/theme/pygments/github.min.css">


  <link rel="stylesheet" type="text/css" href="https://zaurnasibov.com/theme/font-awesome/css/fontawesome.min.css">
  <link rel="stylesheet" type="text/css" href="https://zaurnasibov.com/theme/font-awesome/css/brands.min.css">
  <link rel="stylesheet" type="text/css" href="https://zaurnasibov.com/theme/font-awesome/css/solid.min.css">

  <link rel="stylesheet" type="text/css" href="https://zaurnasibov.com//static/css/extra.css">

  <link rel="shortcut icon" href="/static/images/favicon.png" type="image/x-icon">
  <link rel="icon" href="/static/images/favicon.png" type="image/x-icon">


  <link href="https://zaurnasibov.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Zaur's Thoughts Atom">









<meta name="author" content="Zaur Nasibov" />
<meta name="description" content="After two years of developing a hobby project, I am proud to announce Concrete Settings - a new configuration management library for Python projects. Concrete Settings was born as an effort to improve configuration handling in a huge decade-old Django application with exceedingly bloated settings.py. Remember that settings.py starts …" />
<meta name="keywords" content="programming, library, python, concrete settings">


  <meta property="og:site_name" content="Zaur's Thoughts"/>
  <meta property="og:title" content="Concrete Settings: a new way to manage configurations in Python projects"/>
  <meta property="og:description" content="After two years of developing a hobby project, I am proud to announce Concrete Settings - a new configuration management library for Python projects. Concrete Settings was born as an effort to improve configuration handling in a huge decade-old Django application with exceedingly bloated settings.py. Remember that settings.py starts …"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="https://zaurnasibov.com/posts/2020/07/11/concrete_settings.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2020-07-11 13:06:00+03:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="https://zaurnasibov.com/author/zaur-nasibov.html">
  <meta property="article:section" content="Articles"/>
  <meta property="article:tag" content="programming"/>
  <meta property="article:tag" content="library"/>
  <meta property="article:tag" content="python"/>
  <meta property="article:tag" content="concrete settings"/>
  <meta property="og:image" content="/static/images/logo.png">

  <title>Zaur's Thoughts &ndash; Concrete Settings: a new way to manage configurations in Python projects</title>


</head>
<body class="light-theme">

<aside>
  <div>
    <a href="https://zaurnasibov.com/">
      <img src="/static/images/logo.png" alt="Zaur's Thoughts" title="Zaur's Thoughts">
    </a>

    <h1>
      <a href="https://zaurnasibov.com/">Zaur's Thoughts</a>
    </h1>

    <p>Zaurun Fikirləri</p>


    <nav>
      <ul class="list">

          <li>
            <a target="_self" href="/posts.html" ><strong>Articles</strong></a>
          </li>
          <li>
            <a target="_self" href="/pages/shorts.html" >Shorts</a>
          </li>
          <li>
            <a target="_self" href="/category/books.html" >Books</a>
          </li>


            <li>
              <a target="_self"
                 href="https://zaurnasibov.com/pages/bookmarks.html#bookmarks">
                Bookmarks
              </a>
            </li>
            <li>
              <a target="_self"
                 href="https://zaurnasibov.com/pages/memes.html#memes">
                Memes
              </a>
            </li>
            <li>
              <a target="_self"
                 href="https://zaurnasibov.com/pages/projects.html#projects">
                Projects
              </a>
            </li>
            <li>
              <a target="_self"
                 href="https://zaurnasibov.com/pages/about.html#about">
                About
              </a>
            </li>
      </ul>
    </nav>

    <ul class="social">
      <li>
        <a class="sc-linkedin"
           href="https://www.linkedin.com/in/zaur-nasibov-44610853/"
           target="_blank">
          <i class="fa-brands fa-linkedin"></i>
        </a>
      </li>
      <li>
        <a class="sc-github"
           href="https://github.com/basicwolf"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
      <li>
        <a class="sc-rss"
           href="/feeds/all.atom.xml"
           target="_blank">
          <i class="fa-solid fa-rss"></i>
        </a>
      </li>
    </ul>
  </div>

</aside>
  <main>

<nav>
  <a href="https://zaurnasibov.com/">Home</a>

  <a href="/archives.html">Archives</a>
  <a href="/tags.html">Tags</a>
  <a href="/pages/privacy-policy.html">Privacy Policy</a>
</nav>

<article>
  <header>
      
    <h1 id="concrete_settings">Concrete Settings: a new way to manage configurations in Python projects</h1>
    <p>
      Posted on 11 July 2020 in <a href="https://zaurnasibov.com/category/articles.html">Articles</a>

        &#8226; 5 min read
    </p>
  </header>


  <div>
    <p>After two years of developing a hobby project,
I am proud to announce <strong>Concrete Settings</strong> -
a new configuration management library for Python projects.</p>
<p>Concrete Settings was born as an effort to improve configuration handling in
a huge decade-old Django application with exceedingly bloated <tt class="docutils literal">settings.py</tt>.
Remember that <tt class="docutils literal">settings.py</tt> starts with Django configuration only?
What could go wrong if you start adding <em>application</em> settings to the file?
One setting, two settings, four...</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><span class="n">FEATURE_X</span> <span class="o">=</span> <span class="mi">123</span>
<span class="n">FEATURE_Y_ENABLED</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">FEATURE_Z</span> <span class="o">=</span> <span class="s1">&#39;square&#39;</span>
</pre></div></td></tr></table></div>
<p>In time there were so many settings, that developers loose track of them.
The documentation was scattered around issues tracking tool and outdated wiki pages.
There was little or no settings validation - sometimes customers were getting
<tt class="docutils literal">HTTP 500 - Internal Server Error</tt> due to typo in a setting value.</p>
<p>Concrete Settings does its best to tackle these problems.</p>
<div class="section" id="why">
<h2>Why?</h2>
<p>I was thinking a lot of a developer's and end-user's experience.
How would Concrete Settings library differ from the existing solutions?</p>
<p>After months of experimenting and juggling ideas, the following
ideas laid the foundation:</p>
<ul class="simple">
<li>Settings with their validation rules and documentation are defined in classes.</li>
<li>Validation can happen independently from the application, allowing early fails.</li>
<li>Settings definitions can be nested and mixed.</li>
<li>Application can read settings from developer-defined sources, like
yaml / json / python files, environmental variables etc.</li>
<li>All these are based on Python metaclassing and other capabilities
to minimize the amount of code written by an end-developer.</li>
</ul>
<p>From an end-user's perspective:</p>
<ul class="simple">
<li>Settings are defined in sources. User works with <tt class="docutils literal">application.yml</tt> or <tt class="docutils literal">configuration.json</tt>
environmental variables or custom solutions instead of overbloated <tt class="docutils literal">settings.py</tt>.</li>
<li>An immediate and verbose feedback is received if settings values are invalid.</li>
</ul>
</div>
<div class="section" id="enough-words-show-me-the-code">
<h2>Enough words, show me the code!</h2>
<p>Let's take a look at a simple example and see the bells and whistles
(aka cool features) that are in the box.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># app_settings.py</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">concrete_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">Settings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">concrete_settings.contrib.sources</span><span class="w"> </span><span class="kn">import</span> <span class="n">EnvVarSource</span>


<span class="k">class</span><span class="w"> </span><span class="nc">AppSettings</span><span class="p">(</span><span class="n">Settings</span><span class="p">):</span>

    <span class="c1">#: Whether debug mode is enabled</span>
    <span class="n">DEBUG</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1">#: HTTP server host</span>
    <span class="n">HOST</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span>

    <span class="c1">#: HTTP server listening port</span>
    <span class="n">PORT</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8080</span>

<span class="c1"># Verify settings definition and construct settings object</span>
<span class="n">app_settings</span> <span class="o">=</span> <span class="n">AppSettings</span><span class="p">()</span>

<span class="c1"># Read settings from sources</span>
<span class="n">app_settings</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s1">&#39;settings.yml&#39;</span><span class="p">)</span>
<span class="n">app_settings</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">EnvVarSource</span><span class="p">())</span>

<span class="n">app_settings</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">raise_exception</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Server HOST is </span><span class="si">{</span><span class="n">app_settings</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">AppSettings</span><span class="o">.</span><span class="n">HOST</span><span class="o">.</span><span class="vm">__doc__</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Server PORT is </span><span class="si">{</span><span class="n">app_settings</span><span class="o">.</span><span class="n">PORT</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">AppSettings</span><span class="o">.</span><span class="n">PORT</span><span class="o">.</span><span class="vm">__doc__</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG is </span><span class="si">{</span><span class="n">app_settings</span><span class="o">.</span><span class="n">DEBUG</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">AppSettings</span><span class="o">.</span><span class="n">DEBUG</span><span class="o">.</span><span class="vm">__doc__</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</pre></div></td></tr></table></div>
<p>An end-user is happy with the default <tt class="docutils literal">HOST</tt> value, but wants to override
the rest of the configuration in <tt class="docutils literal">settings.yml</tt></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><span class="nt">PORT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8081</span>
</pre></div></td></tr></table></div>
<p>and set <tt class="docutils literal">DEBUG=true</tt> via an environmental variable.</p>
<p>The output in this case would be:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><span class="go">Server HOST is 127.0.0.1 (HTTP server host)       # default value</span>
<span class="go">Server PORT is 8080 (HTTP server listening port)  # settings.yml</span>
<span class="go">DEBUG is True (Whether debug mode is enabled)     # environmental variable</span>
</pre></div></td></tr></table></div>
</div>
<div class="section" id="document-via-sphinx-style-docstrings">
<h2>Document via sphinx-style docstrings</h2>
<p>Concrete Settings allows documenting settings via
<tt class="docutils literal">#:</tt> Sphinx-style comments:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1">#: HTTP server host</span>
<span class="c1">#: Format: IPv4 address encoded in a string</span>
<span class="n">HOST</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span>
</pre></div></td></tr></table></div>
<p>Documentation can be also passed in an explicit Setting definition.</p>
<p>Let's compare these explicit and implicit definitions:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">AppSettings</span><span class="p">(</span><span class="n">Settings</span><span class="p">):</span>

    <span class="c1">#: HTTP server port</span>
    <span class="n">PORT</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8080</span>

    <span class="n">HOST</span> <span class="o">=</span> <span class="n">Setting</span><span class="p">(</span>
        <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
        <span class="n">type_hint</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;HTTP server host&#39;</span>
    <span class="p">)</span>
</pre></div></td></tr></table></div>
<p>Explicit or implicit - the extracted docstring, is stored
to <tt class="docutils literal">Setting.__doc__</tt>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">AppSettings</span><span class="o">.</span><span class="n">PORT</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">AppSettings</span><span class="o">.</span><span class="n">HOST</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</pre></div></td></tr></table></div>
<p>However, wouldn't you agree that <tt class="docutils literal">PORT</tt> documentation is
way more pleasant to read and maintain?</p>
</div>
<div class="section" id="validate-settings-early-and">
<h2>Validate settings early and...</h2>
<p>What if a user makes a typo and the supplied port is not an integer?</p>
<p>Let's change a value in <tt class="docutils literal">settings.yml</tt> from the first example:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><span class="nt">PORT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8081</span>
</pre></div></td></tr></table></div>
<p>to</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><span class="nt">PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8081&quot;</span>
</pre></div></td></tr></table></div>
<p>Running the first example again would raise an exception:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><span class="go">concrete_settings.exceptions.ValidationError: PORT: Expected value of type `&lt;class &#39;int&#39;&gt;` got value of type `&lt;class &#39;str&#39;&gt;`.</span>
</pre></div></td></tr></table></div>
<p>The validation error message is generated by the default <tt class="docutils literal">ValueTypeValidator</tt>.</p>
</div>
<div class="section" id="add-custom-validators-with-style">
<h2>... add custom validators with style!</h2>
<p>Let's craft a validator which checks that port number is equal or greater than <tt class="docutils literal">8000</tt>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">concrete_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">Settings</span><span class="p">,</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">validate</span>


<span class="k">def</span><span class="w"> </span><span class="nf">port_validator</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">**</span><span class="n">ignore</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="mi">8000</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">65535</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Expected value in range 8000..65535&#39;</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">AppSettings</span><span class="p">(</span><span class="n">Settings</span><span class="p">):</span>

    <span class="c1">#: HTTP server listening port</span>
    <span class="n">PORT</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8080</span> <span class="nd">@validate</span><span class="p">(</span><span class="n">port_validator</span><span class="p">)</span>  <span class="c1"># &lt;--- I know you are scrolling, but have you noticed this?</span>


<span class="n">app_settings</span> <span class="o">=</span> <span class="n">AppSettings</span><span class="p">()</span>
<span class="n">app_settings</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s1">&#39;settings.yml&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">app_settings</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">app_settings</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
</pre></div></td></tr></table></div>
<p>Here we use a decorator-like syntax of so-called <em>behaviors</em>
(actually it's a matrix multiplication operator in this case :).</p>
<p>Let's test it out by changing <tt class="docutils literal">PORT</tt> value in <tt class="docutils literal">settings.yml</tt> to 80:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><span class="nt">PORT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</pre></div></td></tr></table></div>
<p>The result of running the snippet above is</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><span class="go">False</span>
<span class="go">{&#39;PORT&#39;: [&#39;Expected value in range 8000..65535&#39;]}</span>
</pre></div></td></tr></table></div>
<p>If you are still uncomfortable with &#64;behaviors - there is an explicit way to
add validators to settings. Simply pass <tt class="docutils literal">validators</tt> to <tt class="docutils literal">Setting</tt> constructor:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">AppSettings</span><span class="p">(</span><span class="n">Settings</span><span class="p">):</span>

    <span class="c1">#: HTTP server listening port</span>
    <span class="n">PORT</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Setting</span><span class="p">(</span><span class="mi">8080</span><span class="p">,</span> <span class="n">validators</span><span class="o">=</span><span class="p">(</span><span class="n">port_validator</span><span class="p">,))</span>
</pre></div></td></tr></table></div>
</div>
<div class="section" id="helpful-hierarchies">
<h2>Helpful hierarchies</h2>
<p>I never liked settings names like <tt class="docutils literal">DB_HOST_ADDRESS</tt>.
Why have flat settings names, with feature, sub-feature,
configuration, sub-configuration... in them?</p>
<p>Concrete Settings prefers composition over flat-style settings declaration,
though it provides both extension and grouping
mechanism for settings. For example, let's define database and logging
settings in separate classes:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">concrete_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">Settings</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DBSettings</span><span class="p">(</span><span class="n">Settings</span><span class="p">):</span>
    <span class="n">USER</span> <span class="o">=</span> <span class="s1">&#39;alex&#39;</span>
    <span class="n">PASSWORD</span>  <span class="o">=</span> <span class="s1">&#39;secret&#39;</span>
    <span class="n">SERVER</span> <span class="o">=</span> <span class="s1">&#39;localhost@5432&#39;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">LoggingSettings</span><span class="p">(</span><span class="n">Settings</span><span class="p">):</span>
    <span class="n">LEVEL</span> <span class="o">=</span> <span class="s1">&#39;INFO&#39;</span>
    <span class="n">FORMAT</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> </span><span class="si">%(levelname)-8s</span><span class="s1"> </span><span class="si">%(name)-15s</span><span class="s1"> </span><span class="si">%(message)s</span><span class="s1">&#39;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">AppSettings</span><span class="p">(</span><span class="n">Settings</span><span class="p">):</span>
    <span class="n">DB</span> <span class="o">=</span> <span class="n">DBSettings</span><span class="p">()</span>
    <span class="n">LOG</span> <span class="o">=</span> <span class="n">LoggingSettings</span><span class="p">()</span>

<span class="n">app_settings</span> <span class="o">=</span> <span class="n">AppSettings</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">app_settings</span><span class="o">.</span><span class="n">LOG</span><span class="o">.</span><span class="n">LEVEL</span><span class="p">)</span>
</pre></div></td></tr></table></div>
<p>At first glance, there is nothing special about this code.
What makes it special and somewhat confusing is
that class <tt class="docutils literal">Settings</tt> is a subclass of <tt class="docutils literal">Setting</tt>!
Hence, nested Settings behave and can be treated
as Setting descriptors - have validators, documentation
or bound behavior.</p>
<p>Additionally, validating top-level settings
automatically cascades to all nested settings.
The following example ends up with a validation error:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">concrete_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">Settings</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DBSettings</span><span class="p">(</span><span class="n">Settings</span><span class="p">):</span>
    <span class="n">USER</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="mi">123</span>
    <span class="o">...</span>

<span class="k">class</span><span class="w"> </span><span class="nc">AppSettings</span><span class="p">(</span><span class="n">Settings</span><span class="p">):</span>
    <span class="n">DB</span> <span class="o">=</span> <span class="n">DBSettings</span><span class="p">()</span>
    <span class="o">...</span>

<span class="n">app_settings</span> <span class="o">=</span> <span class="n">AppSettings</span><span class="p">()</span>
<span class="n">app_settings</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">raise_exception</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><span class="gt">Traceback (most recent call last):</span>
<span class="w">    </span><span class="o">...</span>
<span class="gr">concrete_settings.exceptions.ValidationError</span>: <span class="n">DB: Expected value of type `&lt;class &#39;str&#39;&gt;` got value of type `&lt;class &#39;int&#39;&gt;`</span>
</pre></div></td></tr></table></div>
<p>Finally, the settings can be read from a similarly nested structure. For example <tt class="docutils literal">settings.json</tt>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><span class="nt">&quot;DB&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;USER&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;admin&quot;</span>
<span class="p">}</span>
</pre></div></td></tr></table></div>
<p>or environmental variable <tt class="docutils literal">DB_USER</tt>.</p>
</div>
<div class="section" id="in-a-retrospective">
<h2>In a retrospective</h2>
<p>This project took a long time to develop. What I did right was
no releasing an unfinished and buggy library. That is probably also
what I did wrong. Trying to polish everything before the first
public release without getting any users feedback is not the best
way to go. Hopefully, there will be feedback and the project
would steer towards its users needs and wishes.</p>
</div>
<div class="section" id="let-s-start">
<h2>Let's start!</h2>
<p>Install it via pip:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>concrete-settings
</pre></div></td></tr></table></div>
<p>and check out the
<a class="reference external" href="https://concrete-settings.readthedocs.org">documentation</a>!</p>
</div>

  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://zaurnasibov.com/tag/programming.html">programming</a>
      <a href="https://zaurnasibov.com/tag/library.html">library</a>
      <a href="https://zaurnasibov.com/tag/python.html">python</a>
      <a href="https://zaurnasibov.com/tag/concrete-settings.html">concrete settings</a>
    </p>
  </div>



  <div class="neighbors">
    <a class="btn float-left" href="https://zaurnasibov.com/posts/2018/04/25/is_classical_music_performed_too_fast.html" title="Is classical music performed too fast?">
      <i class="fa fa-angle-left"></i> Previous Post
    </a>
    <a class="btn float-right" href="https://zaurnasibov.com/posts/2021/06/04/alarms_and_dashboards.html" title="Alarms and dashboards">
      Next Post <i class="fa fa-angle-right"></i>
    </a>
  </div>





</article>

<footer>
<p>&copy; 2025 </p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Zaur's Thoughts ",
  "url" : "https://zaurnasibov.com",
  "image": "/static/images/logo.png",
  "description": ""
}
</script><script defer
  src='https://static.cloudflareinsights.com/beacon.min.js'
  data-cf-beacon='{"token": "1147ebca9f9247a38190f2958de429a8"}'>
</script>

</body>
</html>